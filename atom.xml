<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ivishalgandhi.github.io/</id>
    <title>The Data Column Blog</title>
    <updated>2022-07-09T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ivishalgandhi.github.io/"/>
    <subtitle>The Data Column Blog</subtitle>
    <entry>
        <title type="html"><![CDATA[Guide to Software Bill of Materials(SBoM) and Docker SBOM CLI]]></title>
        <id>docker-sbom</id>
        <link href="https://ivishalgandhi.github.io/docker-sbom"/>
        <updated>2022-07-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[An Software Bill of Materials (SBoM) is a formal record containing the details and supply chain relationships of various components used in building the software. These components, including libraries and modules, can be proprietary or open source,free or paid and the data can be widely available or access-restricted.]]></summary>
        <content type="html"><![CDATA[<p>An <strong>Software Bill of Materials (SBoM)</strong> is a formal record containing the details and supply chain relationships of various components used in building the software. These components, including libraries and modules, can be proprietary or open source,free or paid and the data can be widely available or access-restricted.</p><p><img loading="lazy" src="/assets/images/sbom-e9e0845791a6a0077ec17fe1845f4c36.webp" width="1024" height="652" class="img_ev3q"></p><p>SBoM is analogous to a list of ingredients on food packaging. In May 2021, the US President released the <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/" target="_blank" rel="noopener noreferrer">Executive Order</a> on improving the Nation’s Cybersecurity. The Software Bill of Materials (SBoM) directly impacts all developers. The SBoM requires third-party software companies to provide customers with the code equivalent of a “nutrition chart.”</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-sbom-be-used--use-cases-">When should SBoM be used – Use cases ?<a class="hash-link" href="#when-should-sbom-be-used--use-cases-" title="Direct link to heading">​</a></h2><ul><li><p><strong>Developing products</strong></p><ul><li>Scan vulnerabilities in the components</li><li>Keep codebase to bare minimum, reduce the number of dependencies and size</li><li>Generate SBoM for end users</li></ul></li><li><p><strong>IT Operations</strong></p><ul><li>Understand operational risk</li><li>Understand potential exploitations</li><li>Real time asset inventory</li><li>Software Selection</li><li>Identify known vulnerabilities and compliance</li></ul></li><li><p><strong>EOL</strong></p><ul><li>Complete visibility to components before evaluation or deploying in production</li><li>Understand the software architecture and the dependencies of the software</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-sbom-">Why SBOM ?<a class="hash-link" href="#why-sbom-" title="Direct link to heading">​</a></h2><ul><li><p>Requirement from regulatory bodies to track the components used in the software</p></li><li><p>Transparency of components getting shipped</p></li><li><p>Container ecosystem has exploded and the need to track the components getting shipped is a must</p></li><li><p>Software Vulnerabilities are bugs</p></li><li><p>Detecting and remediating Vulnerabilities</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sbom-formats">SBOM Formats<a class="hash-link" href="#sbom-formats" title="Direct link to heading">​</a></h2><ul><li><p><strong>SPDX (Software Package Data Exchange )</strong></p><ul><li>Open standard for communicating software bill of material information, including components, licenses, copyrights and security references. Reduces redundant work by providing a common format for organizations and communities to share and use</li></ul></li><li><p><strong>CycloneDX</strong></p><ul><li>Open Web Application Security Project(OWASP) CycloneDX is a lightweight Software Bill of Materials (SBOM) standard designed for use in application security contexts and supply chain component analysis.</li></ul></li><li><p><strong>SWID (Software Identification Tags)</strong></p><ul><li>SWID is used primarily to identify installed software and is the preferred format of the NVD. SWID tags are used in the National Vulnerability Database to describe vulnerable components. The CycloneDX specification compliments this work as CycloneDX documents can incorporate SWID tags and other high-level SWID metadata and optionally include entire SWID documents. Use of SWID tag ID’s are useful in determining if a specific component has known vulnerabilities.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-desktop--sbom-cli">Docker Desktop – SBOM CLI<a class="hash-link" href="#docker-desktop--sbom-cli" title="Direct link to heading">​</a></h2><p>In Docker Desktop 4.7.0 Docker introduced and included a new experimental docker sbom CLI that is used for displaying SBoM for any container image. docker sbom scans the layer of container images using the Syft Project</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">​</a></h2><ul><li>Display SBOM in CyloneDX format</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> sbom mongo:latest --format cyclonedx-json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"type"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"library"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"publisher"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"MongoDB Packaging </span><span class="token string entity" style="color:#36acaa">\u003c</span><span class="token string" style="color:#e3116c">packaging@mongodb.com</span><span class="token string entity" style="color:#36acaa">\u003e</span><span class="token string" style="color:#e3116c">"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongodb-org-server"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"version"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"5.0.9"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"cpe"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"cpe:2.3:a:mongodb-org-server:mongodb-org-server:5.0.9:*:*:*:*:*:*:*"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"purl"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"pkg:deb/ubuntu/mongodb-org-server@5.0.9?arch=arm64</span><span class="token string entity" style="color:#36acaa">\u0026</span><span class="token string" style="color:#e3116c">upstream=mongodb-org</span><span class="token string entity" style="color:#36acaa">\u0026</span><span class="token string" style="color:#e3116c">distro=ubuntu-20.04"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"properties"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"syft:package:foundBy"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"value"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dpkgdb-cataloger"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"syft:package:metadataType"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"value"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"DpkgMetadata"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Display SBOM summary of packages. e.g. using the below command we can check for the log4j vulnerabilities</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> sbom neo4j </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> log4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-api                           </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                                     java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-core                          </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                                     java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> sbom neo4j:4.4.1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> log4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-api                           </span><span class="token number" style="color:#36acaa">2.15</span><span class="token plain">.0                                     java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-core                          </span><span class="token number" style="color:#36acaa">2.15</span><span class="token plain">.0                                     java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> sbom elasticsearch:7.16.3 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> log4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elasticsearch-log4j                   </span><span class="token number" style="color:#36acaa">7.16</span><span class="token plain">.3                             java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-1.2-api                         </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                             java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-api                             </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                             java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-core                            </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                             java-archive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log4j-slf4j-impl                      </span><span class="token number" style="color:#36acaa">2.17</span><span class="token plain">.1                             java-archive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are many benefits to generate SBOM for compliance and vulnerability analysis. Further SBOM can be used for input to open source vulnerability databases like <a href="https://github.com/snyk/cli" target="_blank" rel="noopener noreferrer">Snyk</a> and open source vulnerability scanning tools like <a href="https://github.com/anchore/grype" target="_blank" rel="noopener noreferrer">Grype</a></p>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="docker-desktop" term="docker-desktop"/>
        <category label="SBOM" term="SBOM"/>
        <category label="docker" term="docker"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to configure Percona MongoDB Replicaset, Percona Backup Manager, Backup Agent using Docker and perform Replicaset backup, restore using S3 compatible object storage – MINIO]]></title>
        <id>percona-mongo-replicaset-minio</id>
        <link href="https://ivishalgandhi.github.io/percona-mongo-replicaset-minio"/>
        <updated>2022-05-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In this blog post, i will walk you through the steps required to containerize Percona Server for MongoDB, Percona Backup Manager, and Agent from source and configure cloud-native S3(Simple Storage Service) compatible distributed object storage MINIO to backup and restore Percona MongoDB snapshot backups.]]></summary>
        <content type="html"><![CDATA[<p>In this blog post, i will walk you through the steps required to containerize <a href="https://github.com/percona/percona-server-mongodb" target="_blank" rel="noopener noreferrer">Percona Server for MongoDB</a>, <a href="https://github.com/percona/percona-backup-mongodb" target="_blank" rel="noopener noreferrer">Percona Backup Manager</a>, and Agent from source and configure cloud-native S3(<strong>S</strong>imple <strong>S</strong>torage <strong>S</strong>ervice) compatible distributed object storage <a href="https://min.io/" target="_blank" rel="noopener noreferrer">MINIO</a> to backup and restore Percona MongoDB snapshot backups.</p><p><img loading="lazy" src="/assets/images/minio-be0df17e540f83ca7fda66435ae2b18c.webp" width="834" height="433" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><p>Ensure the below binaries are installed before starting the setup and configuration</p><p><a href="https://www.docker.com/get-started/" target="_blank" rel="noopener noreferrer">Docker</a> or <a href="https://podman.io/" target="_blank" rel="noopener noreferrer">Podman</a> to containerize Percona MongoDB replicaset and PBM Agent
<a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">Docker Compose</a>
<a href="https://go.dev/learn/" target="_blank" rel="noopener noreferrer">Golang</a> compiler – Build Percona Backup Manager binaries
<a href="https://www.portainer.io/" target="_blank" rel="noopener noreferrer">Portainer</a> (Optional) – Intuitive UI for container configuration and monitoring
Let us perform the below steps to set up PSMDB Replicaset; PBM Agent; Minio, S3 compatible bucket, and PBM configuration to perform backups and restores from the bucket.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a class="hash-link" href="#steps" title="Direct link to heading">​</a></h2><ul><li>Create the Docker environment file with Docker Image, tag, port, and replicaset information. Save the file as .env in the working directory</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">MONGODB_IMAGE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">percona/percona-server-mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGODB_VERSION</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGO1_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:15000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGO2_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:15001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGO3_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:15002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGODB_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MONGODB_DOCKER_NETWORK</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">RS_NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rs1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create keyFile , Dockerfile and download percona-backup-manager source code in the working directory</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/percona/percona-backup-mongodb.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG MONGODB_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARG MONGODB_IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM </span><span class="token variable" style="color:#36acaa">${MONGODB_IMAGE}</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">${MONGODB_VERSION}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY keyFile /opt/keyFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> mongodb /opt/keyFile </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"> /opt/keyFile </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /home/mongodb/ </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> mongodb /home/mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> mongodb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create Docker Compose file</li></ul><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">version: "3.8"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rs101:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/dev/psmdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_IMAGE=${MONGODB_IMAGE}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: rs101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=mongod"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - REPLSET_NAME=rs1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - MONGO_USER=dba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - BACKUP_USER=bcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - MONGO_PASS=test1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "${MONGO1_PORT}:${MONGODB_PORT}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # command: mongod --replSet rs1 --port ${MONGO1_PORT}:27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["--replSet", "${RS_NAME}", "--bind_ip_all", "--storageEngine", "wiredTiger" , "--keyFile", "/opt/keyFile"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs101:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./scripts/start.sh:/opt/start.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rs102:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/dev/psmdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_IMAGE=${MONGODB_IMAGE}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: rs102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=mongod"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # command: mongod --replSet rs1 --port 27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "${MONGO2_PORT}:${MONGODB_PORT}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["--replSet", "${RS_NAME}", "--bind_ip_all", "--storageEngine", "wiredTiger" , "--keyFile", "/opt/keyFile"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs102:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rs103:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/dev/psmdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_IMAGE=${MONGODB_IMAGE}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: rs103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=mongod"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # command: mongod --replSet rs1 --port 27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "${MONGO3_PORT}:${MONGODB_PORT}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["--replSet", "${RS_NAME}", "--bind_ip_all", "--storageEngine", "wiredTiger" , "--keyFile", "/opt/keyFile"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs103:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent-rs101:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: "pbmagent_rs101"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: "1001"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.agent.rs=rs1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs101:27017"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/open-source/percona-backup-mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./conf:/etc/pbm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./backups:/opt/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs101:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: pbm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cap_add:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - NET_ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent-rs102:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: "pbmagent_rs102"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: "1001"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.agent.rs=rs1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs102:27017"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/open-source/percona-backup-mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./conf:/etc/pbm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./backups:/opt/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs102:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: pbm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cap_add:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - NET_ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent-rs103:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: "pbmagent_rs103"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: "1001"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "com.percona.pbm.agent.rs=rs1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - "PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs103:27017"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - "com.percona.pbm.app=agent"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      context: /home/vishal/open-source/percona-backup-mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./conf:/etc/pbm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ./backups:/opt/backups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data-rs103:/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: pbm-agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cap_add:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - NET_ADMIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backups: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data-rs101: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data-rs102: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data-rs103: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Run Docker compose
The below command will build and start the docker container for Percona Server MongoDB Primary Secondary Secondary replicaset and Percona Backup Manager Agent for each replicaset</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ psmdb docker compose -f docker-compose-rs.yaml up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Running 8/8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container psmdb-rs102-1 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container psmdb-rs103-1 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container pbmagent_rs103 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container pbmagent_rs102 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container psmdb-rs101-1 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠿ Container pbmagent_rs101 Running 0.0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Connect to MongoDB replicaset and ensure replication and containers are working</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mongo </span><span class="token string" style="color:#e3116c">"mongodb://dba:test1234@192.168.50.113:15000,192.168.50.113:15001,192.168.50.113:15002/admin?replicaSet=rs1"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Setup Minio and Minio CLI</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> ~/downloads </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://dl.min.io/server/minio/release/linux-amd64/minio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://dl.min.io/client/mc/release/linux-amd64/mc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mc --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$  downloads ./minio server /home/vishal/data --address</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API: http://0.0.0.0:7000 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RootUser: minioadmin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RootPass: minioadmin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Finished loading IAM sub-system </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">took </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.0s of </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.0s to load data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console: http://192.168.50.113:43859 http://192.168.160.1:43859 http://172.18.0.1:43859 http://172.19.0.1:43859 http://172.24.0.1:43859 http://172.26.0.1:43859 http://172.17.0.1:43859 http://127.0.0.1:43859                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RootUser: minioadmin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RootPass: minioadmin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command-line: https://docs.min.io/docs/minio-client-quickstart-guide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   $ </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"> </span><span class="token builtin class-name">alias</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> myminio http://0.0.0.0:7000 minioadmin minioadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Documentation: https://docs.min.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Setup Minio server alias and List buckets</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$  </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"> </span><span class="token builtin class-name">alias</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> minio-deb http://192.168.50.113:7000 minioadmin minioadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$  </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> minio-deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:59:32 IST</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 0B nocodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29 00:19:41 IST</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 0B typesense/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create a new bucket and name it <code>pbm</code></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"> </span><span class="token builtin class-name">alias</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> minio-deb http://192.168.50.113:7000 minioadmin minioadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mc</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> minio-deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29 </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:59:32 IST</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 0B nocodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29 00:19:41 IST</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 0B typesense/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Setup PBM or compile PBM from the source repository</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y libkrb5-dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> percona-backup-mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>create pbm_config.YAML to be used for configuring PBM for using MINIO</li></ul><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: s3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      endpointUrl: http://192.168.50.113:7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bucket: pbm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      credentials:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        access-key-id: "minioadmin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret-access-key: "minioadmin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Configure PBM</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./pbm config --file /home/vishal/dev/psmdb/pbm_config.yaml --mongodb-uri</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Validate agent container logs and run the pbm list command. If MINIO is configured successfully, agent container logs shouldn’t log any errors.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T01:31:14.000+0000 D </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">resync</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> got backups list: 02022-05-29T01:31:14.000+0000 D </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">resync</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> got physical restores list: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bin git:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ./pbm list --mongodb-uri</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Backup snapshots:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T01:29:12Z </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">complete: </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T01:29:16Z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T01:38:38Z </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">complete: </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T01:38:42Z</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T04:04:44Z </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">complete: </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T04:04:48Z</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>To run PBM backup and restore execute the below commands</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./pbm backup --mongodb-uri</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./pbm restore </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-05-29T04:04:44Z --mongodb-uri</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">"mongodb:/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="mongodb" term="mongodb"/>
        <category label="containers" term="containers"/>
        <category label="docker" term="docker"/>
        <category label="s3" term="s3"/>
        <category label="minio" term="minio"/>
        <category label="pbm" term="pbm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Local Home Lab DNS Setup with DNSMasq and NGINX]]></title>
        <id>local-home-lab</id>
        <link href="https://ivishalgandhi.github.io/local-home-lab"/>
        <updated>2022-04-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[As I explored and set up an increased number of FOSS software using containers(Docker and LXD) and virtual machines(Multipass) in my home lab environment, I realized the difficulty in remembering the different ports the applications and containers are running. The solution to address this problem was to have a Domain Name System for the local network, which works to resolve local and external addresses with a reverse proxy to redirect calls based on DNS resolution.]]></summary>
        <content type="html"><![CDATA[<p>As I explored and set up an increased number of FOSS software using containers(Docker and LXD) and virtual machines(Multipass) in my home lab environment, I realized the difficulty in remembering the different ports the applications and containers are running. The solution to address this problem was to have a Domain Name System for the local network, which works to resolve local and external addresses with a reverse proxy to redirect calls based on DNS resolution.</p><p>The below command lists the Docker Containers and ports the container are running on, the requirement is to create a domain for a home setup with domain homelab.net and access the containerized applications with appsmith.homelab.net; typesense.homelab.net; excalidraw.homelab.net</p><p>Let’s get the list of docker containers with port numbers</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># get container names and port numbers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> container </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> --format </span><span class="token string" style="color:#e3116c">"table {{.ID}}</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">{{.Names}}</span><span class="token string entity" style="color:#36acaa">\t</span><span class="token string" style="color:#e3116c">{{.Ports}}"</span><span class="token plain"> -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   NAMES                        PORTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cbb2ac402270   appsmith                     </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:9001-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">9001</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:70-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:444-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c9875323b989   typesense_typesense-1_1      </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8108-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8108</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c453288c8496   excalidraw                   </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:3001-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5be5d33f1f50   k8s-control-plane            </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:34589-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">6443</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4140d2fbf7d5   mysql_nocodb_1               </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8082-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e7310461bee9   mysql_root_db_1              </span><span class="token number" style="color:#36acaa">3306</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">33060</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9b56c33d45d5   meilisearch_ms_1             </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:7700-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">7700</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9ac6a0e16b0e   mongo2                       </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:20002-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2aaf01d2233f   mongo1                       </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:20001-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">860b521f97dc   mongo3                       </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:20003-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d8ad1ec3cab8   rethinkdb_rethinkdb_1        </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:28015-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">28015</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:29015-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">29015</span><span class="token plain">/tcp, </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8081-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/tcp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The containers and applications running on the local home network as shown above do not have a public domain name, the option was to look for setting up a DNS server with <a href="https://thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noopener noreferrer">DNSMasq</a>, and a reverse proxy using <a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">NGINX</a>. The containers may not be the only use case scenario for local DNS servers with <a href="https://thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noopener noreferrer">DNSMasq</a>, there could be many others like accessing a local file share across devices; accessing applications from a mobile device, and sharing a printer.</p><p><a href="https://thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noopener noreferrer">DNSMasq</a> - Dnsmasq provides network infrastructure for small networks: DNS, DHCP, router advertisement, and network boot. It is designed to be lightweight and has a small footprint, suitable for resource-constrained routers and firewalls.</p><p><a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">NGINX</a> - Reverse Proxy – A reverse proxy provides an additional level of abstraction and control to ensure the smooth flow of network traffic between clients and servers.</p><p><strong>Let us get started with the implementation steps for DNSMasq and NGINX. The below steps are performed on Ubuntu 20.04 (Debian-based distro).</strong></p><p>Before starting the installation of DNSMasq, </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-disable-systemd-resolve-which-binds-to-port-53-the-default-port-for-dnsmasq">Step 1: Disable systemd-resolve which binds to port 53, the default port for DNSMasq<a class="hash-link" href="#step-1-disable-systemd-resolve-which-binds-to-port-53-the-default-port-for-dnsmasq" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop systemd-resolved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl disable systemd-resolved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-install-dnsutils-dnsmasq">Step 2: Install DNSUtils, DNSMasq<a class="hash-link" href="#step-2-install-dnsutils-dnsmasq" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> dnsmasq </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> dnsutils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-create-the-dnsmasq-configuration-file">Step 3: Create the DNSMasq configuration file<a class="hash-link" href="#step-3-create-the-dnsmasq-configuration-file" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token assign-left variable" style="color:#36acaa">dnsmasq_conf</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"no-dhcp-interface=enp2s0f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">bogus-priv</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">domain=homelab.net</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">expand-hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">local=/homelab.net/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">domain-needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">no-resolv</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">no-poll</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">server=8.8.8.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">server=8.8.4.4"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> -e </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$dnsmasq_conf</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/dnsmasq.d/home-lab.net </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart dnsmasq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-add-container-dns-records-in-the-fileetchosts-the-records-in-the-hosts-file-will-be-used-by-dnsmasq-for-client-responses">Step 4: Add container DNS records in the file./etc/hosts. The records in the hosts file will be used by DNSMasq for client responses<a class="hash-link" href="#step-4-add-container-dns-records-in-the-fileetchosts-the-records-in-the-hosts-file-will-be-used-by-dnsmasq-for-client-responses" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  $ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/hosts  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># add the below records to the hosts file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#Container DNS records</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># appsmith</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113 appsmith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># excalidraw</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113 excalidraw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># typesense</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113 typesense</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-restart-dnsmasq-service">Step 5: Restart DNSMasq service<a class="hash-link" href="#step-5-restart-dnsmasq-service" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart dnsmasq.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-install-nginx">Step 6: Install NGINX<a class="hash-link" href="#step-6-install-nginx" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-to-enable-reverse-proxy-feature-create-a-new-nginx-configuration-file-in-sites-enabled-directory">Step 6: To enable reverse proxy feature, create a new NGINX configuration file in <code>sites-enabled</code> directory<a class="hash-link" href="#step-6-to-enable-reverse-proxy-feature-create-a-new-nginx-configuration-file-in-sites-enabled-directory" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> $ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> /etc/nginx/sites-enabled/homelab.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          server_name typesense.homelab.net</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          location / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   proxy_bind </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   proxy_pass http://localhost:3000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          server_name appsmith.homelab.net</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          location / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  proxy_bind </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  proxy_pass http://localhost:70</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          listen </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">:80</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          server_name excalidraw.homelab.net</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          location / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  proxy_bind </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.20.113</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  proxy_pass http://localhost:3001</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>proxy_pass</code> argument will forward all incoming client requests to app.homelab.net to the respective app. The IP address and port number can be easily changed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7-reload-nginx-for-the-configuration-to-take-into-effect">Step 7 reload NGINX for the configuration to take into effect<a class="hash-link" href="#step-7-reload-nginx-for-the-configuration-to-take-into-effect" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl reload nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After a successful implementation, we will be able to access container applications using domain URLs as seen in the below screenshot with three panes first pane is appsmith ; second pane is excalidraw and third pane is typesense.</p><p><img loading="lazy" alt="local-home-lab-snapshot" src="/assets/images/2022-07-19-23-09-57-8b3ba580a484e53a7d25c704b6bccf60.png" width="2047" height="1111" class="img_ev3q"></p>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="reverse-proxy" term="reverse-proxy"/>
        <category label="NGINX" term="NGINX"/>
        <category label="DNSMASQ" term="DNSMASQ"/>
        <category label="Lab" term="Lab"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Configure Sharding in MongoDB on Docker Containers]]></title>
        <id>sharding-mongo-docker</id>
        <link href="https://ivishalgandhi.github.io/sharding-mongo-docker"/>
        <updated>2021-10-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In my previous blog post, I posted about configuring Replica Set to meet high availability requirements.]]></summary>
        <content type="html"><![CDATA[<p>In my previous <a href="/mongodb-rs-docker-persistent-volume">blog</a> post, I posted about configuring Replica Set to meet high availability requirements. </p><p>In this post, i cover </p><ul><li>MongoDB Sharded Cluster Components </li><li>Steps to create MongoDB Sharded Cluster using Docker Compose</li><li>Add Replica Set as a Shard</li><li>Sharding Data</li><li>Verify Distribution of Data </li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="replica-set-vs-sharding">Replica Set vs Sharding<a class="hash-link" href="#replica-set-vs-sharding" title="Direct link to heading">​</a></h2><p><strong>Replica Set</strong> is the way of keeping identical set of data on multiple servers. Sharding refers to the process of splitting data across nodes, also known as horizontal partitioning. </p><p>A database <strong>shard</strong>, is a horizontal partition of data in a database,  each node contains different set of the data. </p><p>MongoDB supports and implements <code>auto-sharding</code> by automating balancing of data across the shards. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mongodb-sharding-components">MongoDB Sharding Components<a class="hash-link" href="#mongodb-sharding-components" title="Direct link to heading">​</a></h2><p>The first step in creating a Sharded MongoDB cluster is to understand all the components and processes that constitute a cluster </p><ul><li><strong>Query Router - mongos</strong></li></ul><p>mongos is the routing process. The goal of sharding is to make cluster of 100-1000 nodes looks like a single interface for the application and abstract all the complexity of data access from multiple shards. The mongos router is table of contents and knows where the  data required by application is located, mongos forwards the application request to appropriate shard(s).   </p><ul><li><strong>Config Servers</strong></li></ul><p>Config Servers hold all the metadata about which node is holding which data(chunks). mongos retrieves all the metadata from Config Servers. Config Servers are critical and its important to configure and bring the config servers first, backup config servers and setup config servers as Replica Set.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="steps-to-create-mongodb-sharded-cluster-using-docker-compose">Steps to create MongoDB Sharded Cluster using Docker Compose<a class="hash-link" href="#steps-to-create-mongodb-sharded-cluster-using-docker-compose" title="Direct link to heading">​</a></h2><p>Below image show different components required to setup MongoDB sharding with Replica Set. The image also shows how application communicates to MongoDB sharded cluster. As discussed in the sharding components application always connects first to mongos and mongos communicates with config server (cfg1, cfg2, cfg3 are part of replicaset in below image)</p><div></div><p>Lets setup above MongoDB Sharding Cluster using docker compose</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---author-docker-compose-file">Step 1 - Author Docker Compose file<a class="hash-link" href="#step-1---author-docker-compose-file" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Ensure directory path mentioned in docker compose for persistent volume before the “:” is existing on local host</p></div></div><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard1_mongo1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard1_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard1_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo1/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo1/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo1/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo1/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20005:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard1_mongo2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard1_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard1_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo2/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo2/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo2/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo2/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20006:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard1_mongo3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard1_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard1_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo3/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo3/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo3/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard1_mongo3/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20007:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard2_mongo1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard2_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard2_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo1/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo1/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo1/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo1/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20008:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard2_mongo2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard2_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard2_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo2/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo2/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo2/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo2/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20009:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard2_mongo3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard2_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard2_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo3/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo3/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo3/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard2_mongo3/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20010:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard3_mongo1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard3_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard3_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo1/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo1/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo1/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo1/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20011:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard3_mongo2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard3_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard3_mongo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo2/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo2/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo2/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo2/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20012:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shard3_mongo3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: shard3_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: shard3_mongo3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo3/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo3/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo3/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/shard3_mongo3/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20013:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MongoDB Confiugration Server </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cfg1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: cfg1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: cfg1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg1/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg1/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg1/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg1/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20014:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cfg2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: cfg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: cfg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg2/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg2/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg2/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg2/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20015:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cfg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: cfg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: cfg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg3/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg3/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg3/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/cfg3/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20016:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mongos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: mongo_ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: mongos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_name: mongos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/mongos/mongod.conf:/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/mongos/initdb.d/:/docker-entrypoint-initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/mongos/data/db/:/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ~/db/mongos/log/:/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - 20017:27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command: ["mongos","-f", "/etc/mongod.conf"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---draft-config-server-configuration-file-pass-clusterrole-configsvr-to-indicate-this-server-is-config-server">Step 2 - Draft Config Server configuration file (pass clusterRole: configsvr to indicate this server is Config Server)<a class="hash-link" href="#step-2---draft-config-server-configuration-file-pass-clusterrole-configsvr-to-indicate-this-server-is-config-server" title="Direct link to heading">​</a></h3><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemLog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  destination: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logAppend: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path: /var/log/mongodb/mongod.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dbPath: /data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  journal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  engine:  wiredTiger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bindIp: 127.0.0.1  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharding:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterRole: configsvr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replication:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replSetName: rs_config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---draft-query-router-mongos-configuration-file-pass-configdbconfig-server-list">Step 3 - Draft Query Router mongos configuration file (pass configDB:config server list)<a class="hash-link" href="#step-3---draft-query-router-mongos-configuration-file-pass-configdbconfig-server-list" title="Direct link to heading">​</a></h3><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemLog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  destination: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logAppend: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path: /var/log/mongodb/mongod.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bindIp: 127.0.0.1  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharding:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  configDB: rs_config/cfg1:27017,cfg2:27017,cfg3:27017</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4---copy-mongodconf-and-mongosconf-to-the-path-mentioned-in-step-1-docker-composeyaml">Step 4 - Copy mongod.conf and mongos.conf to the path mentioned in step 1 <code>docker-compose.yaml</code><a class="hash-link" href="#step-4---copy-mongodconf-and-mongosconf-to-the-path-mentioned-in-step-1-docker-composeyaml" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5---spin-up-config-server-mongos-all-mongod-nodes">Step 5 - Spin up Config Server, mongos, all mongod nodes<a class="hash-link" href="#step-5---spin-up-config-server-mongos-all-mongod-nodes" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6---connect-to-config-server-and-add-config-server-in-a-replica-set">Step 6 - Connect to config server and add config server in a Replica Set<a class="hash-link" href="#step-6---connect-to-config-server-and-add-config-server-in-a-replica-set" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">rs_config</span><span class="token operator" style="color:#393A34">:</span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">rs_config</span><span class="token operator" style="color:#393A34">:</span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"cfg2:27017"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">rs_config</span><span class="token operator" style="color:#393A34">:</span><span class="token constant" style="color:#36acaa">PRIMARY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"cfg3:27017"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-7----add-all-data-nodes-to-replicaset">Step 7 -  Add all data nodes to replicaset<a class="hash-link" href="#step-7----add-all-data-nodes-to-replicaset" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># </span><span class="token maybe-class-name">Connect</span><span class="token plain"> to shard1_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard1_mongo2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo1 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard1_mongo3"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># </span><span class="token maybe-class-name">Connect</span><span class="token plain"> to shard2_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard2_mongo2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo2 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard2_mongo3"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># </span><span class="token maybe-class-name">Connect</span><span class="token plain"> to shard3_mongo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo3 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> other</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard3_mongo2"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo3 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shard3_mongo3"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-8--connect-to-mongos-and-convert-data-replicaset-nodes-to-shards">Step 8 – Connect to mongos and convert data replicaset nodes to shards<a class="hash-link" href="#step-8--connect-to-mongos-and-convert-data-replicaset-nodes-to-shards" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"rs_mongo1/shard1_mongo1:27017,shard1_mongo2:27017,shard1_mongo3:27017"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"rs_mongo2/shard2_mongo1:27017,shard2_mongo2:27017,shard2_mongo3:27017"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">"rs_mongo3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">shard3_mongo1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard3_mongo2</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-9--connect-to-mongos-and-enable-sharding-on-a-test-database-employee">Step 9 – Connect to mongos and enable sharding on a test database “Employee”<a class="hash-link" href="#step-9--connect-to-mongos-and-enable-sharding-on-a-test-database-employee" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">adminCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">enableSharding</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"employee"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-10--generate-test-data--create-an-index-on-the-key-to-be-sharded-and-shard-the-collection">Step 10 – Generate test data ; Create an index on the key to be sharded and shard the collection<a class="hash-link" href="#step-10--generate-test-data--create-an-index-on-the-key-to-be-sharded-and-shard-the-collection" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> use employee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">switched to db employee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emp_list2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"sr_no"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"emp # "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"create_date"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emp_list2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">"sr_no"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hashed"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">shardCollection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"employee.emp_list2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">"sr_no"</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">"hashed"</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"collectionsharded"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"employee.emp_list2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"collectionUUID"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">UUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"17195baa-fc6c-4c3e-8a2b-58fb1278e40c"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"ok"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"operationTime"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Timestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1633177398</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"$clusterTime"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"clusterTime"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Timestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1633177398</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"signature"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"hash"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">BinData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"keyId"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">NumberLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-11--validate-sharding-status">Step 11 – Validate sharding status<a class="hash-link" href="#step-11--validate-sharding-status" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sh</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token maybe-class-name">Sharding</span><span class="token plain"> </span><span class="token maybe-class-name">Status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sharding version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"minCompatibleVersion"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"currentVersion"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"clusterId"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">ObjectId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"6157efd7982782e314f1b651"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">shards</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo1"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo1/shard1_mongo1:27017,shard1_mongo2:27017,shard1_mongo3:27017"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"state"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo2/shard2_mongo1:27017,shard2_mongo2:27017,shard2_mongo3:27017"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"state"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo3"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo3/shard3_mongo1:27017,shard3_mongo2:27017,shard3_mongo3:27017"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"state"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  active mongoses</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"4.4.8"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">autosplit</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Currently</span><span class="token plain"> enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">balancer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Currently</span><span class="token plain"> enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Currently</span><span class="token plain"> running</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Failed</span><span class="token plain"> balancer rounds </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> last </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">attempts</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Migration</span><span class="token plain"> </span><span class="token maybe-class-name">Results</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> the last </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">hours</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">682</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">databases</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"config"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"primary"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"config"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"partitioned"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">system</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sessions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        shard key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">unique</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">balancing</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo1   </span><span class="token number" style="color:#36acaa">342</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo2   </span><span class="token number" style="color:#36acaa">341</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo3   </span><span class="token number" style="color:#36acaa">341</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        too many chunks to print</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> use verbose </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> you want to force print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       employee</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emp_list2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        shard key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"sr_no"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"hashed"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">unique</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">balancing</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo1   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo2   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                rs_mongo3   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-12---validate-chunk-distribution">Step 12 - Validate chunk distribution<a class="hash-link" href="#step-12---validate-chunk-distribution" title="Direct link to heading">​</a></h3><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getSiblingDB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"employee"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emp_list2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getShardDistribution</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo1 at rs_mongo1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">shard1_mongo1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard1_mongo2</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard1_mongo3</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">09MiB docs </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33426</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated data per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">04MiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated docs per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16713</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo3 at rs_mongo3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">shard3_mongo1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard3_mongo2</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard3_mongo3</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">09MiB docs </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33379</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated data per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">04MiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated docs per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16689</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo2 at rs_mongo2</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">shard2_mongo1</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard2_mongo2</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">shard2_mongo3</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">08MiB docs </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33195</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated data per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">04MiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> estimated docs per chunk </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16597</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Totals</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">28MiB docs </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">chunks</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo1 contains </span><span class="token number" style="color:#36acaa">33.42</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33.42</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docs </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avg obj size on shard </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 65B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo3 contains </span><span class="token number" style="color:#36acaa">33.37</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33.37</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docs </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avg obj size on shard </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> 65B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token maybe-class-name">Shard</span><span class="token plain"> rs_mongo2 contains </span><span class="token number" style="color:#36acaa">33.19</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33.19</span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> docs </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avg </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="mongodb" term="mongodb"/>
        <category label="docker" term="docker"/>
        <category label="sharding" term="sharding"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MongoDB Replicaset with Persistent Volume using Docker Compose]]></title>
        <id>mongodb-rs-docker-persistent-volume</id>
        <link href="https://ivishalgandhi.github.io/mongodb-rs-docker-persistent-volume"/>
        <updated>2021-09-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In this article we will see the steps required to create and configure MongoDB replicaset containers on persistent volumes using Docker Compose. Compose was developed to define, configure and spin-up multi-container docker applications with single command, further reducing . Extensive usage of Docker with several container management quickly becomes cumbersome, Compose overcomes this problem and allows to easily handle multiple containers at once using YAML configuration docker-compose.yml]]></summary>
        <content type="html"><![CDATA[<p>In this article we will see the steps required to create and configure MongoDB replicaset containers on <strong>persistent volumes</strong> using <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">Docker Compose</a>. Compose was developed to define, configure and spin-up multi-container docker applications with single command, further reducing . Extensive usage of Docker with several container management quickly becomes cumbersome, Compose overcomes this problem and allows to easily handle multiple containers at once using YAML configuration <code>docker-compose.yml</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose-steps">Docker Compose Steps<a class="hash-link" href="#docker-compose-steps" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-system-configuration">Step 1: System Configuration<a class="hash-link" href="#step-1-system-configuration" title="Direct link to heading">​</a></h3><p>To run Compose, make sure you have installed Compose on your local system where Docker is installed. The Compose setup and installation instructions can be found here.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-ensure-mongo_net-network-bridge-is-already-existing">Step 2: Ensure mongo_net network bridge is already existing<a class="hash-link" href="#step-2-ensure-mongo_net-network-bridge-is-already-existing" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> network create mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> network inspect mongo_net                       </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-lets-convert-the-below-command-as-seen-in-previous-blog-post-to-docker-composeyml-if-you-are-new-to-docker-and-drafting-compose-files-try-using-composerize-to-convert-docker-run-commands-into-compose-yaml-output">Step 3: Lets convert the below command as seen in previous blog post to docker-compose.yml. If you are new to Docker and drafting compose files try using composerize to convert docker run commands into compose YAML output<a class="hash-link" href="#step-3-lets-convert-the-below-command-as-seen-in-previous-blog-post-to-docker-composeyml-if-you-are-new-to-docker-and-drafting-compose-files-try-using-composerize-to-convert-docker-run-commands-into-compose-yaml-output" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">20003</span><span class="token plain">:27017 --name mongo3 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are few additional attributes passed in the <code>docker-compose.yml</code>. The difference in the options passed in the command line above and <code>docker-compose.yml</code> is as below</p><ul><li>image: custom image uploaded to docker hub with additional utilities installed on ubuntu build
hostname: container host name</li><li>volumes: map directory on the host file system to manage and store container data. In the below YAML i use separate directory for all 3 MongoDB replicaset. This helps in creating persistent data store for docker containers and doesn’t bloat the container runtime instance.</li><li>Pass mongod configuration options through file mongod.conf</li></ul><p>Create the below YAML compose file in your favourite editor, i have been using Visual Studio Code. Save the file as docker-compose.yml</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ code </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#version: "3.3"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo_1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ivishalgandhi/mongo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_1/mongod.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_1/initdb.d/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_1/data/db/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_1/log/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 20003</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"-f"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc/mongod.conf"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">"--replSet"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo_2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ivishalgandhi/mongo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_2/mongod.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_2/initdb.d/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_2/data/db/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_2/log/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 20004</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"-f"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc/mongod.conf"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">"--replSet"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo_3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ivishalgandhi/mongo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_3/mongod.conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_3/initdb.d/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">initdb.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_3/data/db/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/data/db/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /Users/vishalgandhi/learning/docker/mongo_replset/mongo_3/log/</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/mongodb/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 20005</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"-f"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc/mongod.conf"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">"--replSet"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-create-mongodconf">Step 4: create mongod.conf<a class="hash-link" href="#step-4-create-mongodconf" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$  code .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-YAML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-YAML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># for documentation of all options, see:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   http://docs.mongodb.org/manual/reference/configuration-options/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># where to write logging data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemLog:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  destination: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logAppend: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path: /var/log/mongodb/mongod.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Where and how to store data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">storage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dbPath: /data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  journal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  engine:  wiredTiger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># network interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 27017</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bindIp: 127.0.0.1  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-5-spin-up-replicaset-containers">Step 5: Spin-up replicaset containers<a class="hash-link" href="#step-5-spin-up-replicaset-containers" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Running </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Container mongo_2  Created                                                                                                                                   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Container mongo_1  Created                                                                                                                                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">.2s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ⠿ Container mongo_3  Created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-6-initiate-replicaset">Step 6: Initiate replicaset<a class="hash-link" href="#step-6-initiate-replicaset" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it mongo_1 </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@mongo_1:/</span><span class="token comment" style="color:#999988;font-style:italic"># mongo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo:SECONDARY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs.initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      _id: “rs_mongo”,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      members: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> _id: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> “mongo_1:27017” </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> _id: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> “mongo_2:27017” </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> _id: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">, </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> “mongo_3:27017” </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo:SECONDARY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db.</span><span class="token function-name function" style="color:#d73a49">isMaster</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"topologyVersion"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"processId"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> ObjectId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"614615744d54c08963ef67f6"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"counter"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> NumberLong</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"hosts"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"mongo_1:27017"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"mongo_2:27017"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"mongo_3:27017"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"setName"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"setVersion"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"ismaster"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"secondary"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"primary"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo_2:27017"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"me"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo_2:27017"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="mongodb" term="mongodb"/>
        <category label="docker" term="docker"/>
        <category label="replicaset" term="replicaset"/>
        <category label="persistent-volume" term="persistent-volume"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Create MongoDB Standalone and Replica Set containers using Docker]]></title>
        <id>create-mongodb-docker</id>
        <link href="https://ivishalgandhi.github.io/create-mongodb-docker"/>
        <updated>2021-09-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Docker Containers offer easy setup, customization and scalability. In this article, i will walk you through how to use Docker to setup MongoDB standalone and replica set containers within minutes.]]></summary>
        <content type="html"><![CDATA[<p>Docker Containers offer easy setup, customization and scalability. In this article, i will walk you through how to use Docker to setup MongoDB standalone and replica set containers within minutes.</p><p>The article is divided in two parts, the first part is setting up the standalone MongoDB container and second part is setting up and grouping MongoDB containers as member of replica set with Docker.</p><p>Let’s get started.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-configuration">System Configuration<a class="hash-link" href="#system-configuration" title="Direct link to heading">​</a></h2><p>To run this setup, Docker Engine is required to be installed on the system. Follow the official documentation to setup Docker Engine on your system.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>The steps and configuration for both standalone and replica set is not to be used for production deployment. The intended use is only for setting up a environment to support learning of MongoDB.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="standalone-mongodb-setup">Standalone MongoDB Setup<a class="hash-link" href="#standalone-mongodb-setup" title="Direct link to heading">​</a></h2><ul><li>Pull the Docker MongoDB official image from Docker Hub. The following code snippet demonstrates pulling the docker MongoDB 4.4.9 release. To pull the MongoDB 5.0 latest release replace :4.4.9-rc0 with :latest tag</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull mongo:4.4.9-rc0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>To check if the the image pull from Docker Hub was successful</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker images                                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REPOSITORY   TAG         IMAGE ID       CREATED       SIZE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo        4.4.9-rc0   24599d6cde30   9 days ago    413MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo        latest      31299b956c79   10 days ago   642MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Lets start first standalone container – the below command starts MongoDB docker container with name mongo_449 in detached mode using the 4.4.9-rc0 image</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --name mongo_449 -d mongo:4.4.9-rc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>List the container status and health by executing</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> container </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE          COMMAND                  CREATED       STATUS                      PORTS       NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">96e64ec525a2   24599d6cde30   </span><span class="token string" style="color:#e3116c">"docker-entrypoint.s…"</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> hours ago   Up </span><span class="token number" style="color:#36acaa">33</span><span class="token plain"> minutes               </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain">/tcp   mongo_449</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>To run a command inside the container<ul><li>docker exec: interact with containers (running/up mode)</li><li>-i : interactive STDIN open even if not attached to the container</li><li>-t: pseudo TTY</li></ul></li></ul><ul><li>Connect to MongoDB daemon</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@96e64ec525a2:/</span><span class="token comment" style="color:#999988;font-style:italic"># mongo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MongoDB shell version v4.4.9-rc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connecting to: mongodb://127.0.0.1:27017/?compressors</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">disabled</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">gssapiServiceName</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">mongodb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Implicit session: session </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"id"</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ac624a79-908b-4580-90ae-22d0a7aee07a"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MongoDB server version: </span><span class="token number" style="color:#36acaa">4.4</span><span class="token plain">.9-rc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Install utilities. The utilities ping, systemctl, sudo installed in the containers can be used for troubleshooting during the setup of Docker containers.</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@96e64ec525a2:/</span><span class="token comment" style="color:#999988;font-style:italic"># apt-get install iputils-ping̵</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@96e64ec525a2:/</span><span class="token comment" style="color:#999988;font-style:italic"># apt-get install sudo </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@96e64ec525a2:/</span><span class="token comment" style="color:#999988;font-style:italic"># apt-get install systemctl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This finishes the setup of standalone MongoDB Container. Now let’s look at ReplicaSet setup.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-mongodb-replicaset-using-docker">Creating MongoDB ReplicaSet using Docker<a class="hash-link" href="#creating-mongodb-replicaset-using-docker" title="Direct link to heading">​</a></h2><p>A replica set consists of a primary node together with two or more secondary nodes. It is recommended to group three or more nodes, with an odd number of total nodes. The primary node accepts all the write requests which are propagated synchronously or asynchronously to the secondary nodes. Below are the steps required to complete the replica set setup using Docker.</p><p>Create a new network(bridge) within Docker. The replica set containers will be mapped to the new network.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> network create mongo_net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> network inspect mongo_net                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"Name"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo_net"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"Id"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"e2567806642a9245436371a9b9904c71fadae969fbd11a7bb8203e07976b1b2a"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"Created"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2021-09-11T00:36:33.989688708Z"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"Scope"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"local"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"Driver"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"bridge"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"EnableIPv6"</span><span class="token builtin class-name">:</span><span class="token plain"> false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"IPAM"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"Driver"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"default"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"Options"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"Config"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"Subnet"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.18.0.0/16"</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"Gateway"</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"172.18.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Start 3 containers – Primary Secondary Secondary<ul><li>Break down of parameters docker run : start a new container<ul><li><code>-d</code> :  run the container in detached mode</li><li><code>-p 20001:27017</code> publish container port to the host and bind 27017 to 20001 on the host. This is useful if connecting mongo client like mongosh to container</li><li><code>--name</code> : name of the mongo container</li><li><code>-- network</code> : connect to user created network mongo_net</li><li><code>mongo:4.4.9-rc0</code> : Docker MongoDB image</li><li><code>mongod --replSet rs_mongo</code> : run the mongod daemon and add the container to replica set name rs_mongo</li></ul></li></ul></li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">20001</span><span class="token plain">:27017 --name mongo1 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">20002</span><span class="token plain">:27017 --name mongo2 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d -p </span><span class="token number" style="color:#36acaa">20003</span><span class="token plain">:27017 --name mongo3 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Set up Replica set. Connect to one of the containers and run the below commands. The container that receives the initiate will pass on the configuration to other containers assigned as members.</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rs_mongo"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"members"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo1:27017"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo2:27017"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"_id"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"host"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mongo3:27017"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//Insert test data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> admin</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> use test_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">employees</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"vishal"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//To read queries on secondary run setReadPref. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> secondary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMongo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setReadPref</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'secondary'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> secondary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">employees</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">ObjectId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"613c99801ea796508e3c73f5"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vishal'</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Validate Replica Set Configuration</li></ul><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">printReplicationInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configured oplog size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'557174 MB'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log length start to end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'71372 secs (19.83 hrs)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oplog first event time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'Sat Sep 11 2021 15:47:21 GMT+0530 (India Standard Time)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oplog last event time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'Sun Sep 12 2021 11:36:53 GMT+0530 (India Standard Time)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">'Sun Sep 12 2021 11:36:54 GMT+0530 (India Standard Time)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs_mongo </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">direct</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> test_2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">conf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'rs_mongo'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">term</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">protocolVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Long</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"1"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">writeConcernMajorityJournalDefault</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">members</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mongo1:27017'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">arbiterOnly</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">buildIndexes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">hidden</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tags</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">slaveDelay</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Long</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">votes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mongo2:27017'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">arbiterOnly</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">buildIndexes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">hidden</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tags</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">slaveDelay</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Long</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">votes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">_id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mongo3:27017'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">arbiterOnly</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">buildIndexes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">hidden</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">priority</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tags</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">slaveDelay</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Long</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"0"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">votes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That concludes this article.</p>]]></content>
        <author>
            <name>Vishal Gandhi</name>
            <uri>https://github.com/ivishalgandhi</uri>
        </author>
        <category label="mongodb" term="mongodb"/>
        <category label="containers" term="containers"/>
        <category label="docker" term="docker"/>
        <category label="mongo-replicaset" term="mongo-replicaset"/>
    </entry>
</feed>