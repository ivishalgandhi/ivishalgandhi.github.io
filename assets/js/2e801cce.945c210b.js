"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9450],{6029:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"docker-sbom","metadata":{"permalink":"/docker-sbom","source":"@site/blog/2022-07-09-docker-sbom.md","title":"Guide to Software Bill of Materials(SBoM) and Docker SBOM CLI","description":"An Software Bill of Materials (SBoM) is a formal record containing the details and supply chain relationships of various components used in building the software. These components, including libraries and modules, can be proprietary or open source,free or paid and the data can be widely available or access-restricted.","date":"2022-07-09T00:00:00.000Z","formattedDate":"July 9, 2022","tags":[{"label":"docker-desktop","permalink":"/tags/docker-desktop"},{"label":"SBOM","permalink":"/tags/sbom"},{"label":"docker","permalink":"/tags/docker"}],"readingTime":2.895,"hasTruncateMarker":true,"authors":[{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"}],"frontMatter":{"slug":"docker-sbom","title":"Guide to Software Bill of Materials(SBoM) and Docker SBOM CLI","authors":{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"},"tags":["docker-desktop","SBOM","docker"]},"nextItem":{"title":"How to configure Percona MongoDB Replicaset, Percona Backup Manager, Backup Agent using Docker and perform Replicaset backup, restore using S3 compatible object storage \u2013 MINIO","permalink":"/percona-mongo-replicaset-minio"}},"content":"An **Software Bill of Materials (SBoM)** is a formal record containing the details and supply chain relationships of various components used in building the software. These components, including libraries and modules, can be proprietary or open source,free or paid and the data can be widely available or access-restricted.\\n\\n\x3c!--truncate--\x3e\\n\\n![](sbom.webp)\\n\\nSBoM is analogous to a list of ingredients on food packaging. In May 2021, the US President released the [Executive Order](https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/) on improving the Nation\u2019s Cybersecurity. The Software Bill of Materials (SBoM) directly impacts all developers. The SBoM requires third-party software companies to provide customers with the code equivalent of a \u201cnutrition chart.\u201d\\n\\n## When should SBoM be used \u2013 Use cases ?\\n\\n* **Developing products**\\n  * Scan vulnerabilities in the components\\n  * Keep codebase to bare minimum, reduce the number of dependencies and size\\n  * Generate SBoM for end users\\n\\n* **IT Operations**\\n  * Understand operational risk\\n  * Understand potential exploitations\\n  * Real time asset inventory\\n  * Software Selection\\n  * Identify known vulnerabilities and compliance\\n\\n* **EOL**\\n  * Complete visibility to components before evaluation or deploying in production\\n  * Understand the software architecture and the dependencies of the software\\n\\n## Why SBOM ?\\n\\n* Requirement from regulatory bodies to track the components used in the software\\n\\n* Transparency of components getting shipped\\n\\n* Container ecosystem has exploded and the need to track the components getting shipped is a must\\n\\n* Software Vulnerabilities are bugs\\n\\n* Detecting and remediating Vulnerabilities\\n\\n## SBOM Formats\\n\\n* **SPDX (Software Package Data Exchange )**\\n  * Open standard for communicating software bill of material information, including components, licenses, copyrights and security references. Reduces redundant work by providing a common format for organizations and communities to share and use\\n\\n* **CycloneDX**\\n  * Open Web Application Security Project(OWASP) CycloneDX is a lightweight Software Bill of Materials (SBOM) standard designed for use in application security contexts and supply chain component analysis.\\n\\n* **SWID (Software Identification Tags)**\\n  * SWID is used primarily to identify installed software and is the preferred format of the NVD. SWID tags are used in the National Vulnerability Database to describe vulnerable components. The CycloneDX specification compliments this work as CycloneDX documents can incorporate SWID tags and other high-level SWID metadata and optionally include entire SWID documents. Use of SWID tag ID\u2019s are useful in determining if a specific component has known vulnerabilities.\\n\\n## Docker Desktop \u2013 SBOM CLI\\n\\nIn Docker Desktop 4.7.0 Docker introduced and included a new experimental docker sbom CLI that is used for displaying SBoM for any container image. docker sbom scans the layer of container images using the Syft Project\\n\\n## Usage\\n\\n* Display SBOM in CyloneDX format\\n\\n\\n```shell\\n\\t\\n$ docker sbom mongo:latest --format cyclonedx-json | more\\n \\n{\\n      \\"type\\": \\"library\\",\\n      \\"publisher\\": \\"MongoDB Packaging \\\\u003cpackaging@mongodb.com\\\\u003e\\",\\n      \\"name\\": \\"mongodb-org-server\\",\\n      \\"version\\": \\"5.0.9\\",\\n      \\"cpe\\": \\"cpe:2.3:a:mongodb-org-server:mongodb-org-server:5.0.9:*:*:*:*:*:*:*\\",\\n      \\"purl\\": \\"pkg:deb/ubuntu/mongodb-org-server@5.0.9?arch=arm64\\\\u0026upstream=mongodb-org\\\\u0026distro=ubuntu-20.04\\",\\n      \\"properties\\": [\\n        {\\n          \\"name\\": \\"syft:package:foundBy\\",\\n          \\"value\\": \\"dpkgdb-cataloger\\"\\n        },\\n        {\\n          \\"name\\": \\"syft:package:metadataType\\",\\n          \\"value\\": \\"DpkgMetadata\\"\\n        }\\n```\\n\\n* Display SBOM summary of packages. e.g. using the below command we can check for the log4j vulnerabilities\\n\\n```shell\\t\\n$ docker sbom neo4j | grep log4j\\n \\nlog4j-api                           2.17.1                                     java-archive\\nlog4j-core                          2.17.1                                     java-archive\\n\\t\\n$ docker sbom neo4j:4.4.1 | grep log4j\\n \\nlog4j-api                           2.15.0                                     java-archive\\nlog4j-core                          2.15.0                                     java-archive\\n\\t\\n$ docker sbom elasticsearch:7.16.3 | grep log4j\\n \\nelasticsearch-log4j                   7.16.3                             java-archive\\nlog4j-1.2-api                         2.17.1                             java-archive\\nlog4j-api                             2.17.1                             java-archive\\nlog4j-core                            2.17.1                             java-archive\\nlog4j-slf4j-impl                      2.17.1                             java-archive\\n```\\n\\nThere are many benefits to generate SBOM for compliance and vulnerability analysis. Further SBOM can be used for input to open source vulnerability databases like [Snyk](https://github.com/snyk/cli) and open source vulnerability scanning tools like [Grype](https://github.com/anchore/grype)"},{"id":"percona-mongo-replicaset-minio","metadata":{"permalink":"/percona-mongo-replicaset-minio","source":"@site/blog/2022-05-29-percona-mongo-replicaset-minio.md","title":"How to configure Percona MongoDB Replicaset, Percona Backup Manager, Backup Agent using Docker and perform Replicaset backup, restore using S3 compatible object storage \u2013 MINIO","description":"In this blog post, i will walk you through the steps required to containerize Percona Server for MongoDB, Percona Backup Manager, and Agent from source and configure cloud-native S3(Simple Storage Service) compatible distributed object storage MINIO to backup and restore Percona MongoDB snapshot backups.","date":"2022-05-29T00:00:00.000Z","formattedDate":"May 29, 2022","tags":[{"label":"mongodb","permalink":"/tags/mongodb"},{"label":"containers","permalink":"/tags/containers"},{"label":"docker","permalink":"/tags/docker"},{"label":"s3","permalink":"/tags/s-3"},{"label":"minio","permalink":"/tags/minio"},{"label":"pbm","permalink":"/tags/pbm"}],"readingTime":4.205,"hasTruncateMarker":true,"authors":[{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"}],"frontMatter":{"slug":"percona-mongo-replicaset-minio","title":"How to configure Percona MongoDB Replicaset, Percona Backup Manager, Backup Agent using Docker and perform Replicaset backup, restore using S3 compatible object storage \u2013 MINIO","authors":{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"},"tags":["mongodb","containers","docker","s3","minio","pbm"]},"prevItem":{"title":"Guide to Software Bill of Materials(SBoM) and Docker SBOM CLI","permalink":"/docker-sbom"},"nextItem":{"title":"Local Home Lab DNS Setup with DNSMasq and NGINX","permalink":"/local-home-lab"}},"content":"In this blog post, i will walk you through the steps required to containerize [Percona Server for MongoDB](https://github.com/percona/percona-server-mongodb), [Percona Backup Manager](https://github.com/percona/percona-backup-mongodb), and Agent from source and configure cloud-native S3(**S**imple **S**torage **S**ervice) compatible distributed object storage [MINIO](https://min.io/) to backup and restore Percona MongoDB snapshot backups.\\n\\n\x3c!--truncate--\x3e\\n\\n![](minio.webp)\\n\\n## Prerequisites\\nEnsure the below binaries are installed before starting the setup and configuration\\n\\n[Docker](https://www.docker.com/get-started/) or [Podman](https://podman.io/) to containerize Percona MongoDB replicaset and PBM Agent\\n[Docker Compose](https://docs.docker.com/compose/install/)\\n[Golang](https://go.dev/learn/) compiler \u2013 Build Percona Backup Manager binaries\\n[Portainer](https://www.portainer.io/) (Optional) \u2013 Intuitive UI for container configuration and monitoring\\nLet us perform the below steps to set up PSMDB Replicaset; PBM Agent; Minio, S3 compatible bucket, and PBM configuration to perform backups and restores from the bucket.\\n\\n## Steps\\n* Create the Docker environment file with Docker Image, tag, port, and replicaset information. Save the file as .env in the working directory\\n\\n```shell \\nMONGODB_IMAGE=percona/percona-server-mongodb\\nMONGODB_VERSION=5.0\\nMONGO1_PORT=0.0.0.0:15000\\nMONGO2_PORT=0.0.0.0:15001\\nMONGO3_PORT=0.0.0.0:15002\\nMONGODB_PORT=27017\\nMONGODB_DOCKER_NETWORK=mongo_net\\nRS_NAME=rs1\\n\\n```\\n* Create keyFile , Dockerfile and download percona-backup-manager source code in the working directory\\n\\n```shell\\n$ git clone https://github.com/percona/percona-backup-mongodb.git\\n\\nARG MONGODB_VERSION\\nARG MONGODB_IMAGE\\nFROM ${MONGODB_IMAGE}:${MONGODB_VERSION}\\nUSER root\\nCOPY keyFile /opt/keyFile\\nRUN chown mongodb /opt/keyFile && chmod 400 /opt/keyFile && mkdir -p /home/mongodb/ && chown mongodb /home/mongodb\\nUSER mongodb\\n```\\n* Create Docker Compose file\\n\\n```YAML\\nversion: \\"3.8\\"\\nservices:\\n  rs101:\\n    build:\\n      dockerfile: Dockerfile\\n      context: /home/vishal/dev/psmdb\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION}\\n        - MONGODB_IMAGE=${MONGODB_IMAGE}\\n    hostname: rs101\\n    labels:\\n      - \\"com.percona.pbm.app=mongod\\"\\n    environment:\\n      - REPLSET_NAME=rs1\\n      - MONGO_USER=dba\\n      - BACKUP_USER=bcp\\n      - MONGO_PASS=test1234\\n    ports:\\n      - \\"${MONGO1_PORT}:${MONGODB_PORT}\\"\\n    # command: mongod --replSet rs1 --port ${MONGO1_PORT}:27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1\\n    command: [\\"--replSet\\", \\"${RS_NAME}\\", \\"--bind_ip_all\\", \\"--storageEngine\\", \\"wiredTiger\\" , \\"--keyFile\\", \\"/opt/keyFile\\"]\\n    volumes:\\n      - data-rs101:/data/db\\n      - ./scripts/start.sh:/opt/start.sh\\n  rs102:\\n    build:\\n      dockerfile: Dockerfile\\n      context: /home/vishal/dev/psmdb\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION}\\n        - MONGODB_IMAGE=${MONGODB_IMAGE}\\n    hostname: rs102\\n    labels:\\n      - \\"com.percona.pbm.app=mongod\\"\\n    # command: mongod --replSet rs1 --port 27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1\\n    ports:\\n      - \\"${MONGO2_PORT}:${MONGODB_PORT}\\"\\n    command: [\\"--replSet\\", \\"${RS_NAME}\\", \\"--bind_ip_all\\", \\"--storageEngine\\", \\"wiredTiger\\" , \\"--keyFile\\", \\"/opt/keyFile\\"]\\n    volumes:\\n      - data-rs102:/data/db\\n  rs103:\\n    build:\\n      dockerfile: Dockerfile\\n      context: /home/vishal/dev/psmdb\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION}\\n        - MONGODB_IMAGE=${MONGODB_IMAGE}\\n    hostname: rs103\\n    labels:\\n      - \\"com.percona.pbm.app=mongod\\"\\n    # command: mongod --replSet rs1 --port 27017 --storageEngine wiredTiger --keyFile /opt/keyFile --wiredTigerCacheSizeGB 1\\n    ports:\\n      - \\"${MONGO3_PORT}:${MONGODB_PORT}\\"\\n    command: [\\"--replSet\\", \\"${RS_NAME}\\", \\"--bind_ip_all\\", \\"--storageEngine\\", \\"wiredTiger\\" , \\"--keyFile\\", \\"/opt/keyFile\\"]\\n    volumes:\\n      - data-rs103:/data/db\\n  agent-rs101:\\n    container_name: \\"pbmagent_rs101\\"\\n    user: \\"1001\\"\\n    labels:\\n      - \\"com.percona.pbm.app=agent\\"\\n      - \\"com.percona.pbm.agent.rs=rs1\\"\\n    environment:\\n      - \\"PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs101:27017\\"\\n    build:\\n      labels:\\n        - \\"com.percona.pbm.app=agent\\"\\n      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile\\n      context: /home/vishal/open-source/percona-backup-mongodb/\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}\\n    volumes:\\n      - ./conf:/etc/pbm\\n      - ./backups:/opt/backups\\n      - data-rs101:/data/db\\n    command: pbm-agent\\n    cap_add:\\n      - NET_ADMIN\\n  agent-rs102:\\n    container_name: \\"pbmagent_rs102\\"\\n    user: \\"1001\\"\\n    labels:\\n      - \\"com.percona.pbm.app=agent\\"\\n      - \\"com.percona.pbm.agent.rs=rs1\\"\\n    environment:\\n      - \\"PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs102:27017\\"\\n    build:\\n      labels:\\n        - \\"com.percona.pbm.app=agent\\"\\n      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile\\n      context: /home/vishal/open-source/percona-backup-mongodb/\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}\\n    volumes:\\n      - ./conf:/etc/pbm\\n      - ./backups:/opt/backups\\n      - data-rs102:/data/db\\n    command: pbm-agent\\n    cap_add:\\n      - NET_ADMIN\\n  agent-rs103:\\n    container_name: \\"pbmagent_rs103\\"\\n    user: \\"1001\\"\\n    labels:\\n      - \\"com.percona.pbm.app=agent\\"\\n      - \\"com.percona.pbm.agent.rs=rs1\\"\\n    environment:\\n      - \\"PBM_MONGODB_URI=mongodb://${BACKUP_USER:-bcp}:${MONGO_PASS:-test1234}@rs103:27017\\"\\n    build:\\n      labels:\\n        - \\"com.percona.pbm.app=agent\\"\\n      dockerfile: /home/vishal/open-source/percona-backup-mongodb/docker/Dockerfile\\n      context: /home/vishal/open-source/percona-backup-mongodb/\\n      args:\\n        - MONGODB_VERSION=${MONGODB_VERSION:-5.0}\\n    volumes:\\n      - ./conf:/etc/pbm\\n      - ./backups:/opt/backups\\n      - data-rs103:/data/db\\n    command: pbm-agent\\n    cap_add:\\n      - NET_ADMIN\\nvolumes:\\n  backups: null\\n  data-rs101: null\\n  data-rs102: null\\n  data-rs103: null\\n\\n```\\n\\n* Run Docker compose\\nThe below command will build and start the docker container for Percona Server MongoDB Primary Secondary Secondary replicaset and Percona Backup Manager Agent for each replicaset\\n\\n```\\n$ psmdb docker compose -f docker-compose-rs.yaml up -d\\n[+] Running 8/8\\n\u283f Container psmdb-rs102-1 Running 0.0s\\n\u283f Container psmdb-rs103-1 Running 0.0s\\n\u283f Container pbmagent_rs103 Running 0.0s\\n\u283f Container pbmagent_rs102 Running 0.0s\\n\u283f Container psmdb-rs101-1 Running 0.0s\\n\u283f Container pbmagent_rs101 Running 0.0s\\n\\n```\\n\\n* Connect to MongoDB replicaset and ensure replication and containers are working\\n\\n```shell\\n$ mongo \\"mongodb://dba:test1234@192.168.50.113:15000,192.168.50.113:15001,192.168.50.113:15002/admin?replicaSet=rs1\\"\\n```\\n\\n* Setup Minio and Minio CLI\\n\\n```shell\\n\\n$ cd ~/downloads && wget https://dl.min.io/server/minio/release/linux-amd64/minio\\n \\n$ wget https://dl.min.io/client/mc/release/linux-amd64/mc\\nchmod +x mc\\n./mc --help\\n \\n$  downloads ./minio server /home/vishal/data --address=0.0.0.0:7000\\n \\n\\nAPI: http://0.0.0.0:7000 \\nRootUser: minioadmin \\nRootPass: minioadmin \\nFinished loading IAM sub-system (took 0.0s of 0.0s to load data).\\n \\nConsole: http://192.168.50.113:43859 http://192.168.160.1:43859 http://172.18.0.1:43859 http://172.19.0.1:43859 http://172.24.0.1:43859 http://172.26.0.1:43859 http://172.17.0.1:43859 http://127.0.0.1:43859                   \\nRootUser: minioadmin \\nRootPass: minioadmin \\n \\nCommand-line: https://docs.min.io/docs/minio-client-quickstart-guide\\n   $ mc alias set myminio http://0.0.0.0:7000 minioadmin minioadmin\\n \\nDocumentation: https://docs.min.io\\n\\n\\n```\\n\\n* Setup Minio server alias and List buckets\\n\\n```shell\\n$  mc alias set minio-deb http://192.168.50.113:7000 minioadmin minioadmin\\n$  mc ls minio-deb\\n[2022-05-29 14:59:32 IST] 0B nocodb/\\n[2022-05-29 00:19:41 IST] 0B typesense/\\n\\n```\\n\\n* Create a new bucket and name it `pbm`\\n\\n```shell\\n$ mc alias set minio-deb http://192.168.50.113:7000 minioadmin minioadmin\\n$ mc ls minio-deb\\n  [2022-05-29 14:59:32 IST] 0B nocodb/\\n  [2022-05-29 00:19:41 IST] 0B typesense/\\n```\\n\\n* Setup PBM or compile PBM from the source repository\\n\\n```shell\\n$ sudo apt-get install -y libkrb5-dev\\n$ cd percona-backup-mongodb\\n$ make build\\n$ make install\\n```\\n* create pbm_config.YAML to be used for configuring PBM for using MINIO\\n\\n```YAML\\n\\nstorage:\\n    type: s3\\n    s3:\\n      endpointUrl: http://192.168.50.113:7000\\n      bucket: pbm\\n      credentials:\\n        access-key-id: \\"minioadmin\\"\\n        secret-access-key: \\"minioadmin\\"\\n\\n\\n```\\n\\n* Configure PBM\\n\\n```shell\\n$ ./pbm config --file /home/vishal/dev/psmdb/pbm_config.yaml --mongodb-uri=\\"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1\\"\\n\\n```\\n* Validate agent container logs and run the pbm list command. If MINIO is configured successfully, agent container logs shouldn\u2019t log any errors.\\n\\n```shell\\n2022-05-29T01:31:14.000+0000 D [resync] got backups list: 02022-05-29T01:31:14.000+0000 D [resync] got physical restores list: 0\\n\\n$ bin git:(main) ./pbm list --mongodb-uri=\\"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1\\"\\nBackup snapshots:\\n2022-05-29T01:29:12Z [complete: 2022-05-29T01:29:16Z]\\n2022-05-29T01:38:38Z [complete: 2022-05-29T01:38:42Z]\\n2022-05-29T04:04:44Z [complete: 2022-05-29T04:04:48Z]\\n```\\n\\n* To run PBM backup and restore execute the below commands\\n\\n```bash \\n$ ./pbm backup --mongodb-uri=\\"mongodb://bcp:test1234@192.168.50.113:15000/?replSetName=rs1\\" \\n$ ./pbm restore 2022-05-29T04:04:44Z --mongodb-uri=\\"mongodb:/\\n```"},{"id":"local-home-lab","metadata":{"permalink":"/local-home-lab","source":"@site/blog/2022-04-10-local-home-lab.md","title":"Local Home Lab DNS Setup with DNSMasq and NGINX","description":"As I explored and set up an increased number of FOSS software using containers(Docker and LXD) and virtual machines(Multipass) in my home lab environment, I realized the difficulty in remembering the different ports the applications and containers are running. The solution to address this problem was to have a Domain Name System for the local network, which works to resolve local and external addresses with a reverse proxy to redirect calls based on DNS resolution.","date":"2022-04-10T00:00:00.000Z","formattedDate":"April 10, 2022","tags":[{"label":"reverse-proxy","permalink":"/tags/reverse-proxy"},{"label":"NGINX","permalink":"/tags/nginx"},{"label":"DNSMASQ","permalink":"/tags/dnsmasq"},{"label":"Lab","permalink":"/tags/lab"}],"readingTime":3.34,"hasTruncateMarker":true,"authors":[{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"}],"frontMatter":{"slug":"local-home-lab","title":"Local Home Lab DNS Setup with DNSMasq and NGINX","authors":{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"},"tags":["reverse-proxy","NGINX","DNSMASQ","Lab"]},"prevItem":{"title":"How to configure Percona MongoDB Replicaset, Percona Backup Manager, Backup Agent using Docker and perform Replicaset backup, restore using S3 compatible object storage \u2013 MINIO","permalink":"/percona-mongo-replicaset-minio"},"nextItem":{"title":"Create MongoDB Standalone and Replica Set containers using Docker","permalink":"/create-mongodb-docker"}},"content":"As I explored and set up an increased number of FOSS software using containers(Docker and LXD) and virtual machines(Multipass) in my home lab environment, I realized the difficulty in remembering the different ports the applications and containers are running. The solution to address this problem was to have a Domain Name System for the local network, which works to resolve local and external addresses with a reverse proxy to redirect calls based on DNS resolution.\\n\\n\x3c!--truncate--\x3e\\n\\n\\nThe below command lists the Docker Containers and ports the container are running on, the requirement is to create a domain for a home setup with domain homelab.net and access the containerized applications with appsmith.homelab.net; typesense.homelab.net; excalidraw.homelab.net\\n\\nLet\u2019s get the list of docker containers with port numbers\\n\\n```shell\\n# get container names and port numbers\\n$ docker container ls --format \\"table {{.ID}}\\\\t{{.Names}}\\\\t{{.Ports}}\\" -a\\n\\n\\nCONTAINER ID   NAMES                        PORTS\\ncbb2ac402270   appsmith                     0.0.0.0:9001->9001/tcp, 0.0.0.0:70->80/tcp, 0.0.0.0:444->443/tcp\\nc9875323b989   typesense_typesense-1_1      0.0.0.0:8108->8108/tcp\\nc453288c8496   excalidraw                   0.0.0.0:3001->80/tcp\\n5be5d33f1f50   k8s-control-plane            127.0.0.1:34589->6443/tcp\\n4140d2fbf7d5   mysql_nocodb_1               0.0.0.0:8082->8080/tcp\\ne7310461bee9   mysql_root_db_1              3306/tcp, 33060/tcp\\n9b56c33d45d5   meilisearch_ms_1             0.0.0.0:7700->7700/tcp\\n9ac6a0e16b0e   mongo2                       0.0.0.0:20002->27017/tcp\\n2aaf01d2233f   mongo1                       0.0.0.0:20001->27017/tcp\\n860b521f97dc   mongo3                       0.0.0.0:20003->27017/tcp\\nd8ad1ec3cab8   rethinkdb_rethinkdb_1        0.0.0.0:28015->28015/tcp, 0.0.0.0:29015->29015/tcp, 0.0.0.0:8081->8080/tcp\\n```\\n\\nThe containers and applications running on the local home network as shown above do not have a public domain name, the option was to look for setting up a DNS server with [DNSMasq](https://thekelleys.org.uk/dnsmasq/doc.html), and a reverse proxy using [NGINX](https://www.nginx.com/). The containers may not be the only use case scenario for local DNS servers with [DNSMasq](https://thekelleys.org.uk/dnsmasq/doc.html), there could be many others like accessing a local file share across devices; accessing applications from a mobile device, and sharing a printer.\\n\\n\\n[DNSMasq](https://thekelleys.org.uk/dnsmasq/doc.html) - Dnsmasq provides network infrastructure for small networks: DNS, DHCP, router advertisement, and network boot. It is designed to be lightweight and has a small footprint, suitable for resource-constrained routers and firewalls.\\n\\n[NGINX](https://www.nginx.com/) - Reverse Proxy \u2013 A reverse proxy provides an additional level of abstraction and control to ensure the smooth flow of network traffic between clients and servers.\\n\\n**Let us get started with the implementation steps for DNSMasq and NGINX. The below steps are performed on Ubuntu 20.04 (Debian-based distro).**\\n\\nBefore starting the installation of DNSMasq, \\n\\n### Step 1: Disable systemd-resolve which binds to port 53, the default port for DNSMasq\\n\\n```shell\\n\\n sudo systemctl stop systemd-resolved\\n sudo systemctl disable systemd-resolved\\n\\n```\\n\\n### Step 2: Install DNSUtils, DNSMasq\\n\\n```shell\\nsudo apt update && sudo apt install dnsmasq && sudo apt install dnsutils\\n```\\n\\n### Step 3: Create the DNSMasq configuration file\\n\\n```shell\\n$ dnsmasq_conf=\\"no-dhcp-interface=enp2s0f0\\nbogus-priv\\ndomain=homelab.net\\nexpand-hosts\\nlocal=/homelab.net/\\ndomain-needed\\nno-resolv\\nno-poll\\nserver=8.8.8.8\\nserver=8.8.4.4\\"\\n\\n$ sudo echo -e \\"$dnsmasq_conf\\" > /etc/dnsmasq.d/home-lab.net \\n\\n$ sudo systemctl restart dnsmasq\\n```\\n\\n\\n### Step 4: Add container DNS records in the file./etc/hosts. The records in the hosts file will be used by DNSMasq for client responses\\n\\n```shell\\n  $ sudo nano /etc/hosts  \\n  # add the below records to the hosts file\\n  #Container DNS records\\n  # appsmith\\n  192.168.20.113 appsmith\\n  # excalidraw\\n  192.168.20.113 excalidraw\\n  # typesense\\n  192.168.20.113 typesense\\n```\\n\\n### Step 5: Restart DNSMasq service\\n\\n```shell\\n$ sudo systemctl restart dnsmasq.service\\n```\\n\\n### Step 6: Install NGINX\\n\\n```shell\\n$ sudo apt update && sudo apt install nginx\\n```\\n\\n\\n### Step 6: To enable reverse proxy feature, create a new NGINX configuration file in `sites-enabled` directory\\n\\n```shell\\n $ sudo nano /etc/nginx/sites-enabled/homelab.conf\\n  server {\\n          listen 80;\\n          listen [::]:80;\\n          server_name typesense.homelab.net;\\n          location / {\\n                   proxy_bind 192.168.20.113;\\n                   proxy_pass http://localhost:3000;\\n          }\\n  }\\n  server {\\n          listen 80;\\n          listen [::]:80;\\n          server_name appsmith.homelab.net;\\n          location / {\\n                  proxy_bind 192.168.20.113;\\n                  proxy_pass http://localhost:70;\\n          }\\n\\n  }\\n  server {\\n          listen 80;\\n          listen [::]:80;\\n          server_name excalidraw.homelab.net;\\n          location / {\\n                  proxy_bind 192.168.20.113;\\n                  proxy_pass http://localhost:3001;\\n          }\\n\\n  }\\n```\\n\\nThe `proxy_pass` argument will forward all incoming client requests to app.homelab.net to the respective app. The IP address and port number can be easily changed.\\n \\n### Step 7 reload NGINX for the configuration to take into effect\\n```shell \\n$ sudo systemctl reload nginx\\n```\\nAfter a successful implementation, we will be able to access container applications using domain URLs as seen in the below screenshot with three panes first pane is appsmith ; second pane is excalidraw and third pane is typesense.\\n\\n![local-home-lab-snapshot](2022-07-19-23-09-57.png)"},{"id":"create-mongodb-docker","metadata":{"permalink":"/create-mongodb-docker","source":"@site/blog/2021-09-12-create-mongodb-docker.md","title":"Create MongoDB Standalone and Replica Set containers using Docker","description":"Docker Containers offer easy setup, customization and scalability. In this article, i will walk you through how to use Docker to setup MongoDB standalone and replica set containers within minutes.","date":"2021-09-12T00:00:00.000Z","formattedDate":"September 12, 2021","tags":[{"label":"mongodb","permalink":"/tags/mongodb"},{"label":"containers","permalink":"/tags/containers"},{"label":"docker","permalink":"/tags/docker"},{"label":"mongo-replicaset","permalink":"/tags/mongo-replicaset"}],"readingTime":4.65,"hasTruncateMarker":true,"authors":[{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"}],"frontMatter":{"slug":"create-mongodb-docker","title":"Create MongoDB Standalone and Replica Set containers using Docker","authors":{"name":"Vishal Gandhi","url":"https://github.com/ivishalgandhi","image_url":"https://github.com/ivishalgandhi.png","imageURL":"https://github.com/ivishalgandhi.png"},"tags":["mongodb","containers","docker","mongo-replicaset"]},"prevItem":{"title":"Local Home Lab DNS Setup with DNSMasq and NGINX","permalink":"/local-home-lab"}},"content":"Docker Containers offer easy setup, customization and scalability. In this article, i will walk you through how to use Docker to setup MongoDB standalone and replica set containers within minutes.\\n\\nThe article is divided in two parts, the first part is setting up the standalone MongoDB container and second part is setting up and grouping MongoDB containers as member of replica set with Docker.\\n\\nLet\u2019s get started.\\n\\n\x3c!--truncate--\x3e\\n\\n## System Configuration\\n\\nTo run this setup, Docker Engine is required to be installed on the system. Follow the official documentation to setup Docker Engine on your system.\\n\\n:::caution\\n\\nThe steps and configuration for both standalone and replica set is not to be used for production deployment. The intended use is only for setting up a environment to support learning of MongoDB.\\n\\n:::\\n\\n## Standalone MongoDB Setup\\n\\n* Pull the Docker MongoDB official image from Docker Hub. The following code snippet demonstrates pulling the docker MongoDB 4.4.9 release. To pull the MongoDB 5.0 latest release replace :4.4.9-rc0 with :latest tag\\n\\n```shell \\n\\n$ docker pull mongo:4.4.9-rc0 \\n\\n```\\n\\n* To check if the the image pull from Docker Hub was successful\\n\\n\\n```\\n\\n$ docker images                                                   \\nREPOSITORY   TAG         IMAGE ID       CREATED       SIZE\\nmongo        4.4.9-rc0   24599d6cde30   9 days ago    413MB\\nmongo        latest      31299b956c79   10 days ago   642MB\\n\\n```\\n\\n* Lets start first standalone container \u2013 the below command starts MongoDB docker container with name mongo_449 in detached mode using the 4.4.9-rc0 image\\n\\n```shell\\n\\n$ docker run --name mongo_449 -d mongo:4.4.9-rc0\\n\\n```\\n\\n* List the container status and health by executing\\n\\n```shell\\n\\n$ docker container ls -a\\n\\nCONTAINER ID   IMAGE          COMMAND                  CREATED       STATUS                      PORTS       NAMES\\n96e64ec525a2   24599d6cde30   \\"docker-entrypoint.s\u2026\\"   2 hours ago   Up 33 minutes               27017/tcp   mongo_449\\n\\n```\\n\\n* To run a command inside the container\\n  * docker exec: interact with containers (running/up mode)\\n  * -i : interactive STDIN open even if not attached to the container\\n  * -t: pseudo TTY\\n\\n\\n* Connect to MongoDB daemon\\n\\n```shell\\nroot@96e64ec525a2:/# mongo\\n\\nMongoDB shell version v4.4.9-rc0\\nconnecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb\\nImplicit session: session { \\"id\\" : UUID(\\"ac624a79-908b-4580-90ae-22d0a7aee07a\\") }\\nMongoDB server version: 4.4.9-rc0\\n\\n```\\n\\n* Install utilities. The utilities ping, systemctl, sudo installed in the containers can be used for troubleshooting during the setup of Docker containers.\\n\\n```shell\\n\\nroot@96e64ec525a2:/# apt-get install iputils-ping\u0335\\nroot@96e64ec525a2:/# apt-get install sudo \\nroot@96e64ec525a2:/# apt-get install systemctl\\n\\n```\\n\\nThis finishes the setup of standalone MongoDB Container. Now let\u2019s look at ReplicaSet setup.\\n\\n## Creating MongoDB ReplicaSet using Docker\\n\\nA replica set consists of a primary node together with two or more secondary nodes. It is recommended to group three or more nodes, with an odd number of total nodes. The primary node accepts all the write requests which are propagated synchronously or asynchronously to the secondary nodes. Below are the steps required to complete the replica set setup using Docker.\\n\\nCreate a new network(bridge) within Docker. The replica set containers will be mapped to the new network.\\n\\n```shell \\n$ docker network create mongo_net\\n$ docker network inspect mongo_net                       \\n[\\n    {\\n        \\"Name\\": \\"mongo_net\\",\\n        \\"Id\\": \\"e2567806642a9245436371a9b9904c71fadae969fbd11a7bb8203e07976b1b2a\\",\\n        \\"Created\\": \\"2021-09-11T00:36:33.989688708Z\\",\\n        \\"Scope\\": \\"local\\",\\n        \\"Driver\\": \\"bridge\\",\\n        \\"EnableIPv6\\": false,\\n        \\"IPAM\\": {\\n            \\"Driver\\": \\"default\\",\\n            \\"Options\\": {},\\n            \\"Config\\": [\\n                {\\n                    \\"Subnet\\": \\"172.18.0.0/16\\",\\n                    \\"Gateway\\": \\"172.18.0.1\\"\\n                }\\n            ]\\n        },\\n...\\n]\\n```\\n\\n* Start 3 containers \u2013 Primary Secondary Secondary\\n  * Break down of parameters docker run : start a new container\\n    * `-d` :  run the container in detached mode\\n    * `-p 20001:27017` publish container port to the host and bind 27017 to 20001 on the host. This is useful if connecting mongo client like mongosh to container\\n    * `--name` : name of the mongo container\\n    * `-- network` : connect to user created network mongo_net\\n    * `mongo:4.4.9-rc0` : Docker MongoDB image\\n    * `mongod --replSet rs_mongo` : run the mongod daemon and add the container to replica set name rs_mongo\\n\\n```shell \\n$ docker run -d -p 20001:27017 --name mongo1 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo\\n$ docker run -d -p 20002:27017 --name mongo2 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo\\n$ docker run -d -p 20003:27017 --name mongo3 --network mongo_net mongo:4.4.9-rc0 mongod --replSet rs_mongo\\n```\\n\\n* Set up Replica set. Connect to one of the containers and run the below commands. The container that receives the initiate will pass on the configuration to other containers assigned as members.\\n\\n```js\\nrs_mongo [direct: primary] test_2> config = {\\n      \\"_id\\" : \\"rs_mongo\\",\\n      \\"members\\" : [\\n          {\\n              \\"_id\\" : 0,\\n              \\"host\\" : \\"mongo1:27017\\"\\n          },\\n          {\\n              \\"_id\\" : 1,\\n              \\"host\\" : \\"mongo2:27017\\"\\n          },\\n          {\\n              \\"_id\\" : 2,\\n              \\"host\\" : \\"mongo3:27017\\"\\n          }\\n      ]\\n  }\\n\\nrs_mongo [direct: primary] admin> rs.initiate(config)\\n\\n//Insert test data\\n\\nrs_mongo [direct: primary] admin> use test_2\\nrs_mongo [direct: primary] test_2> db.employees.insert({name: \\"vishal\\")\\n\\n//To read queries on secondary run setReadPref. \\nrs_mongo [direct: secondary] test_2>db.getMongo().setReadPref(\'secondary\')\\n\\nrs_mongo [direct: secondary] test_2> db.employees.find()\\n[\\n  { _id: ObjectId(\\"613c99801ea796508e3c73f5\\"), name: \'vishal\' }\\n]\\n\\n```\\n\\n* Validate Replica Set Configuration\\n\\n```js\\nrs_mongo [direct: primary] test_2> db.printReplicationInfo()\\n\\nconfigured oplog size\\n\'557174 MB\'\\n---\\nlog length start to end\\n\'71372 secs (19.83 hrs)\'\\n---\\noplog first event time\\n\'Sat Sep 11 2021 15:47:21 GMT+0530 (India Standard Time)\'\\n---\\noplog last event time\\n\'Sun Sep 12 2021 11:36:53 GMT+0530 (India Standard Time)\'\\n---\\nnow\\n\'Sun Sep 12 2021 11:36:54 GMT+0530 (India Standard Time)\'\\n\\n\\nrs_mongo [direct: primary] test_2> rs.conf()\\n{\\n  _id: \'rs_mongo\',\\n  version: 1,\\n  term: 1,\\n  protocolVersion: Long(\\"1\\"),\\n  writeConcernMajorityJournalDefault: true,\\n  members: [\\n    {\\n      _id: 0,\\n      host: \'mongo1:27017\',\\n      arbiterOnly: false,\\n      buildIndexes: true,\\n      hidden: false,\\n      priority: 1,\\n      tags: {},\\n      slaveDelay: Long(\\"0\\"),\\n      votes: 1\\n    },\\n    {\\n      _id: 1,\\n      host: \'mongo2:27017\',\\n      arbiterOnly: false,\\n      buildIndexes: true,\\n      hidden: false,\\n      priority: 1,\\n      tags: {},\\n      slaveDelay: Long(\\"0\\"),\\n      votes: 1\\n    },\\n    {\\n      _id: 2,\\n      host: \'mongo3:27017\',\\n      arbiterOnly: false,\\n      buildIndexes: true,\\n      hidden: false,\\n      priority: 1,\\n      tags: {},\\n      slaveDelay: Long(\\"0\\"),\\n      votes: 1\\n    }\\n\\n```\\nThat concludes this article."}]}')}}]);